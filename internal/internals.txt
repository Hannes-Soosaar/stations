functions for internal use only